<!DOCTYPE html>
<html xmlns="http://www.thymeleaf.org" th:insert="~{layout :: layout(contentFragment=~{::content})}">

<section th:fragment="content">

	<h1>購入確認画面</h1>

	<form th:action="@{purchase}" method="post" th:object="${updateUserForm}">

	<table>
		<tr>
			<th>名前</th>
			<td>
				<input type="text" th:field="*{name}" required />
				<div th:if="${#fields.hasErrors('name')}" th:errors="*{name}" style="color:red"></div>
			</td>
		</tr>
		<tr>
			<th>郵便番号<span style="color:red;">*</th>
			<td>
				<input type="text" th:field="*{postcode}" placeholder="1234567"  required />
				<div th:if="${#fields.hasErrors('postcode')}" th:errors="*{postcode}" style="color:red"></div>
			</td>
		</tr>
		<tr>
			<th>住所<span style="color:red;">*</th>
			<td>
				<input type="text" th:field="*{address}"  required />
				<div th:if="${#fields.hasErrors('address')}" th:errors="*{address}" style="color:red"></div>
			</td>
		</tr>
		<tr>
			<th>電話番号</th>
			<td>
				<input type="text" th:field="*{tel}" placeholder="09012345678" />
				<div th:if="${#fields.hasErrors('tel')}" th:errors="*{tel}" style="color:red"></div>
			</td>
		</tr>
	</table>

		<input type="hidden" name="itemId" th:value="${item.itemId}" />
		<h3>お支払い方法</h3>
		<label>
			<input type="radio" name="paymentMethod" value="credit" onclick="toggleCreditForm(true)" required />
			クレジットカード
		</label>
		<label>
			<input type="radio" name="paymentMethod" value="convenience" onclick="toggleCreditForm(false)" />
			コンビニ払い
		</label>
		<label>
			<input type="radio" name="paymentMethod" value="carrier" onclick="toggleCreditForm(false)" />
			キャリア払い
		</label>

		<div id="creditCardForm" style="display:none; margin-top: 1em;">
			<h4>クレジットカード情報</h4>
			<input type="hidden" th:field="*{userId}" />
			<label>カード番号:
				<input type="text" name="cardNumber" th:field="*{cardNumber}" placeholder="1234 5678 9012 3456" />
				<div th:if="${#fields.hasErrors('cardNumber')}" th:errors="*{cardNumber}" style="color:red"></div>
			</label><br />
			<label>カード名義:
				<input type="text" name="cardName" th:field="*{cardName}" />
			</label><br />
			<label>有効期限:
				<input type="month" name="expDate" th:field="*{expDate}" />
			</label><br />
			<label>セキュリティコード:
				<input type="number" name="securityCode" th:field="*{securityCode}" placeholder="123" />
				<div th:if="${#fields.hasErrors('securityCode')}" th:errors="*{securityCode}" style="color:red"></div>
			</label>
			<label><br />
				<input type="checkbox" name="saveCardInfo" th:field="*{saveCardInfo}" />
				クレジットカードの情報を保存する
			</label>
		</div>


		<h3>支払金額</h3>
		<p th:unless="${item.price == null}" th:text="|${item.price} 円|">0 円</p>
		<div style="margin-top: 1em;">
			<button type="submit" class="btn">確定</button>
		</div>

	</form>

	<!--クレジット情報の表示/非表示スクリプト-->
	<script>
		function toggleCreditForm(show) {
			const form = document.getElementById('creditCardForm');
			form.style.display = show ? 'block' : 'none';
		}
	</script>
</section>

</html>